<div class="followup-page-container">
  <div class="header-section">
    <h1>Dossiers de Suivi</h1>
  </div>

  <!-- LOADING -->
  @if(loading){
    <div class="loading-message">
      <p>Chargement des dossiers...</p>
    </div>
  }

  <!-- ERROR -->
  @if(error && !loading){
    <div class="error-message">
      <p>{{ error }}</p>
    </div>
  }

  <!-- LISTE DES DOSSIERS -->
  @if(!loading && !error){
    @if(followups && followups.length > 0){
      <div class="followups-grid">
        @for(followup of followups; track followup._id){
          <div class="followup-card">
            <!-- Header du dossier -->
            <div class="card-header">
              <h3>{{ followup.pathology }}</h3>
              <span class="status-badge" [ngClass]="getStatusClass(followup.status)">
                {{ followup.status }}
              </span>
            </div>

            <!-- Informations principales -->
            <div class="card-body">
              <div class="info-row">
                <div class="info-content">
                  <span class="info-label">D√©but :</span>
                  <span class="info-value">{{ formatDate(followup.start_date) }}</span>
                </div>
                <div class="info-content">
                  <span class="info-label">Fin :</span>
                  <span class="info-value">
                    {{ followup.end_date ? formatDate(followup.end_date) : 'En cours' }}
                  </span>
                </div>
              </div>

              <!-- PRESCRIPTIONS -->
              <div class="section prescriptions">
                <h4>Prescriptions ({{ followup.prescriptions?.length || 0 }})</h4>
                @if(followup.prescriptions && followup.prescriptions.length > 0){
                  <ul>
                    @for(prescription of followup.prescriptions; track prescription._id){
                      <li>
                        <strong>{{ prescription.drug_name }}</strong> - {{ prescription.shape }}, {{ prescription.quantity }}
                        ({{ prescription.frequency }} fois/jour)
                        <br>
                        Du {{ formatDate(prescription.start_date) }} au {{ prescription.end_date ? formatDate(prescription.end_date) : 'En cours' }}
                      </li>
                    }
                  </ul>
                }
                @else{
                  <p>Aucune prescription enregistr√©e</p>
                }
              </div>

              <!-- DOCUMENTS M√âDICAUX -->
              <div class="section medical-documents">
                <h4>Documents M√©dicaux ({{ followup.medical_document?.length || 0 }})</h4>
                @if(followup.medical_document && followup.medical_document.length > 0){
                  <ul>
                    @for(doc of followup.medical_document; track doc._id){
                      <li>
                        <strong>{{ doc.type }}</strong> - {{ doc.description || 'Aucune description' }}
                        <br>
                        Date : {{ formatDate(doc.date) }}
                      </li>
                    }
                  </ul>
                }
                @else{
                  <p>Aucun document m√©dical enregistr√©</p>
                }
              </div>
            </div>

            <!-- Actions -->
            <div class="card-actions">
              <button class="btn-action btn-edit"
                      (click)="editFollowup(followup._id, $event)">
                ‚úé Edit
              </button>
              <button class="btn-action btn-delete"
                      (click)="deleteFollowup(followup._id, $event)">
                üóë Supprimer
              </button>
            </div>
          </div>
        }
      </div>
    }
    @else{
      <div class="empty-state">
        <p>Aucun dossier de suivi pour ce patient</p>
        <button class="btn-create-large" (click)="createNewFollowup()">
          Cr√©er le premier dossier
        </button>
      </div>
    }
  }

  <div class="footer-actions">
    <button class="btn-back" (click)="goBack()">‚üµ Retour</button>
  </div>
</div>
